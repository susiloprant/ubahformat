<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Ubah Format Data</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      padding: 30px;
      background: #f4f6f8;
      color: #333;
    }
    h2, h3 {
      color: #2c3e50;
    }
    textarea {
      width: 100%;
      height: 200px;
      margin-bottom: 10px;
      white-space: pre;
      font-family: monospace;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }
    button {
      padding: 8px 15px;
      background-color: #3498db;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    button:hover {
      background-color: #2980b9;
    }
    .error {
      color: red;
      margin-top: 10px;
    }
    .day-column {
      background: white;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 30px;
      box-shadow: 0 3px 6px rgba(0,0,0,0.1);
    }
    .day-column textarea {
      width: 100%;
      height: 200px;
      margin-top: 10px;
    }
    .copied {
      background-color: red !important;
      color: white;
    }
    .copied-twice {
      background-color: purple !important;
      color: white;
    }
    .total-label {
      margin-left: 10px;
      font-weight: bold;
      color: #2c3e50;
    }
    .summary {
      margin: 20px 0;
      font-weight: bold;
      font-size: 1.2em;
      padding: 10px;
      background: #eaf1f8;
      border-left: 5px solid #3498db;
      border-radius: 5px;
    }
  </style>
</head>
<body>
  <h2>Ubah Format Data</h2>
  <label>Masukkan Tanggal dan Data:</label>
  <textarea id="input" placeholder="15 Juni\n5) 08.45' ==> 5K\n..."></textarea>
  <button onclick="convertData()">Ubah Format</button>
  <h3>Hasil Per Hari:</h3>
  <div id="summary" class="summary"></div>
  <div id="outputContainer"></div>
  <div id="error" class="error"></div>

  <script>
    const bulanMap = {
      'januari': 1, 'februari': 2, 'maret': 3, 'april': 4,
      'mei': 5, 'juni': 6, 'juli': 7, 'agustus': 8,
      'september': 9, 'oktober': 10, 'november': 11, 'desember': 12
    };

    function convertData() {
      const lines = document.getElementById('input').value.trim().split('\n');
      const outputByDate = {};
      const totalsByDate = {};
      const errorLines = [];
      let currentKey = '';

      lines.forEach((line, index) => {
        line = line.trim();

        if (/^\d{1,2}\s+[A-Za-z]+$/i.test(line)) {
          currentKey = line;
          if (!outputByDate[currentKey]) {
            outputByDate[currentKey] = [];
            totalsByDate[currentKey] = 0;
          }
        }

        else if (/^\d+\)\s+\d{2}\.\d{2}['']?\s+==>\s+\d+K$/i.test(line)) {
          const match = line.match(/(\d+)\)\s+(\d{2})\.(\d{2})['']?\s+==>\s+(\d+)K/i);
          if (match && currentKey) {
            const nomor = match[1];
            const jam = `${match[2]}:${match[3]}`;
            const rawLine = line;
            const hasTick = rawLine.includes("'");
            const kode = hasTick ? 1 : 2;
            const nilai = parseInt(match[4]) * 1000;
            totalsByDate[currentKey] += nilai;
            outputByDate[currentKey].push(`${nomor}\t${jam}\t${kode}\t${nilai}`);
          }
        }

        else if (line === '') {
          // skip
        }

        else {
          errorLines.push(`Baris ${index + 1}: ${line}`);
        }
      });

      const container = document.getElementById('outputContainer');
      const summary = document.getElementById('summary');
      container.innerHTML = '';
      summary.innerHTML = '';

      const sortedKeys = Object.keys(outputByDate).sort((a, b) => {
        const [dayA, monthA] = a.split(' ');
        const [dayB, monthB] = b.split(' ');
        const dateA = new Date(2024, bulanMap[monthA.toLowerCase()] - 1, parseInt(dayA));
        const dateB = new Date(2024, bulanMap[monthB.toLowerCase()] - 1, parseInt(dayB));
        return dateA - dateB;
      });

      let grandTotal = 0;

      sortedKeys.forEach(tanggal => {
        const column = document.createElement('div');
        column.className = 'day-column';

        const title = document.createElement('div');
        title.innerHTML = `<strong>${tanggal}</strong>`;
        column.appendChild(title);

        const controlRow = document.createElement('div');
        controlRow.style.display = 'flex';
        controlRow.style.alignItems = 'center';
        controlRow.style.marginTop = '8px';

        const copyBtn = document.createElement('button');
        copyBtn.innerText = 'Copy';
        let clickCount = 0;
        copyBtn.onclick = () => {
          navigator.clipboard.writeText(outputByDate[tanggal].join('\n'))
            .then(() => {
              clickCount++;
              if (clickCount === 1) {
                copyBtn.classList.remove('copied-twice');
                copyBtn.classList.add('copied');
              } else {
                copyBtn.classList.remove('copied');
                copyBtn.classList.add('copied-twice');
              }
            });
        };
        controlRow.appendChild(copyBtn);

        const totalLabel = document.createElement('span');
        totalLabel.className = 'total-label';
        totalLabel.innerText = `Total: ${totalsByDate[tanggal].toLocaleString('id-ID')}`;
        controlRow.appendChild(totalLabel);

        column.appendChild(controlRow);

        const textarea = document.createElement('textarea');
        textarea.readOnly = true;
        textarea.value = outputByDate[tanggal].join('\n');
        column.appendChild(textarea);

        container.appendChild(column);

        grandTotal += totalsByDate[tanggal];
      });

      if (sortedKeys.length > 0) {
        const rataRata = Math.round(grandTotal / sortedKeys.length);
        summary.innerHTML = `TOTAL: ${grandTotal.toLocaleString('id-ID')}<br>RATA-RATA PER HARI: ${rataRata.toLocaleString('id-ID')}`;
      }

      if (errorLines.length > 0) {
        document.getElementById('error').innerHTML = '<strong>Baris tidak dikenali:</strong><br>' + errorLines.join('<br>');
      } else {
        document.getElementById('error').textContent = '';
      }
    }
  </script>
</body>
</html>
